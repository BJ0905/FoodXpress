//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by Fernflower decompiler)
//

package com.app.dao_implementation;

import com.app.dao.AddressDAO;
import com.app.models.Address;
import com.app.utility.DBConnection;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

public class AddressDAOImpl implements AddressDAO {
    private static final String INSERT_ADDRESS_QUERY = "INSERT INTO addresses (user_id, street, city, state, zip, landmark) VALUES (?, ?, ?, ?, ?, ?)";
    private static final String GET_ADDRESS_BY_ID_QUERY = "SELECT * FROM addresses WHERE address_id = ?";
    private static final String GET_ADDRESSES_BY_USER_QUERY = "SELECT * FROM addresses WHERE user_id = ?";
    private static final String UPDATE_ADDRESS_QUERY = "UPDATE addresses SET street = ?, city = ?, state = ?, zip = ?, landmark = ? WHERE address_id = ?";
    private static final String DELETE_ADDRESS_QUERY = "DELETE FROM addresses WHERE address_id = ?";

    public void addAddress(Address address) {
        try {
            Throwable var2 = null;
            Object var3 = null;

            try {
                Connection connection = DBConnection.getConnection();

                try {
                    PreparedStatement pstmt = connection.prepareStatement("INSERT INTO addresses (user_id, street, city, state, zip, landmark) VALUES (?, ?, ?, ?, ?, ?)");

                    try {
                        pstmt.setInt(1, address.getUserId());
                        pstmt.setString(2, address.getStreet());
                        pstmt.setString(3, address.getCity());
                        pstmt.setString(4, address.getState());
                        pstmt.setString(5, address.getZip());
                        pstmt.setString(6, address.getLandmark());
                        int rowsInserted = pstmt.executeUpdate();
                        if (rowsInserted > 0) {
                            System.out.println("✅ Address inserted successfully.");
                        }
                    } finally {
                        if (pstmt != null) {
                            pstmt.close();
                        }

                    }
                } catch (Throwable var20) {
                    if (var2 == null) {
                        var2 = var20;
                    } else if (var2 != var20) {
                        var2.addSuppressed(var20);
                    }

                    if (connection != null) {
                        connection.close();
                    }

                    throw var2;
                }

                if (connection != null) {
                    connection.close();
                }
            } catch (Throwable var21) {
                if (var2 == null) {
                    var2 = var21;
                } else if (var2 != var21) {
                    var2.addSuppressed(var21);
                }

                throw var2;
            }
        } catch (SQLException e) {
            System.err.println("❌ Error while adding address: " + e.getMessage());
            e.printStackTrace();
        }

    }

    public Address getAddressById(int addressId) {
        Address address = null;

        try {
            Throwable var3 = null;
            Object var4 = null;

            try {
                Connection connection = DBConnection.getConnection();

                try {
                    PreparedStatement pstmt = connection.prepareStatement("SELECT * FROM addresses WHERE address_id = ?");

                    try {
                        pstmt.setInt(1, addressId);
                        ResultSet rs = pstmt.executeQuery();
                        if (rs.next()) {
                            address = this.extractAddress(rs);
                        }
                    } finally {
                        if (pstmt != null) {
                            pstmt.close();
                        }

                    }
                } catch (Throwable var21) {
                    if (var3 == null) {
                        var3 = var21;
                    } else if (var3 != var21) {
                        var3.addSuppressed(var21);
                    }

                    if (connection != null) {
                        connection.close();
                    }

                    throw var3;
                }

                if (connection != null) {
                    connection.close();
                }
            } catch (Throwable var22) {
                if (var3 == null) {
                    var3 = var22;
                } else if (var3 != var22) {
                    var3.addSuppressed(var22);
                }

                throw var3;
            }
        } catch (SQLException e) {
            System.err.println("❌ Error fetching address: " + e.getMessage());
            e.printStackTrace();
        }

        return address;
    }

    public List<Address> getAddressesByUserId(int userId) {
        List<Address> addressList = new ArrayList();

        try {
            Throwable var3 = null;
            Object var4 = null;

            try {
                Connection connection = DBConnection.getConnection();

                try {
                    PreparedStatement pstmt = connection.prepareStatement("SELECT * FROM addresses WHERE user_id = ?");

                    try {
                        pstmt.setInt(1, userId);
                        ResultSet rs = pstmt.executeQuery();

                        while(rs.next()) {
                            addressList.add(this.extractAddress(rs));
                        }
                    } finally {
                        if (pstmt != null) {
                            pstmt.close();
                        }

                    }
                } catch (Throwable var21) {
                    if (var3 == null) {
                        var3 = var21;
                    } else if (var3 != var21) {
                        var3.addSuppressed(var21);
                    }

                    if (connection != null) {
                        connection.close();
                    }

                    throw var3;
                }

                if (connection != null) {
                    connection.close();
                }
            } catch (Throwable var22) {
                if (var3 == null) {
                    var3 = var22;
                } else if (var3 != var22) {
                    var3.addSuppressed(var22);
                }

                throw var3;
            }
        } catch (SQLException e) {
            System.err.println("❌ Error fetching addresses: " + e.getMessage());
            e.printStackTrace();
        }

        return addressList;
    }

    public void updateAddress(Address address) {
        try {
            Throwable var2 = null;
            Object var3 = null;

            try {
                Connection connection = DBConnection.getConnection();

                try {
                    PreparedStatement pstmt = connection.prepareStatement("UPDATE addresses SET street = ?, city = ?, state = ?, zip = ?, landmark = ? WHERE address_id = ?");

                    try {
                        pstmt.setString(1, address.getStreet());
                        pstmt.setString(2, address.getCity());
                        pstmt.setString(3, address.getState());
                        pstmt.setString(4, address.getZip());
                        pstmt.setString(5, address.getLandmark());
                        pstmt.setInt(6, address.getAddressId());
                        int rowsUpdated = pstmt.executeUpdate();
                        if (rowsUpdated > 0) {
                            System.out.println("✅ Address updated successfully.");
                        }
                    } finally {
                        if (pstmt != null) {
                            pstmt.close();
                        }

                    }
                } catch (Throwable var20) {
                    if (var2 == null) {
                        var2 = var20;
                    } else if (var2 != var20) {
                        var2.addSuppressed(var20);
                    }

                    if (connection != null) {
                        connection.close();
                    }

                    throw var2;
                }

                if (connection != null) {
                    connection.close();
                }
            } catch (Throwable var21) {
                if (var2 == null) {
                    var2 = var21;
                } else if (var2 != var21) {
                    var2.addSuppressed(var21);
                }

                throw var2;
            }
        } catch (SQLException e) {
            System.err.println("❌ Error updating address: " + e.getMessage());
            e.printStackTrace();
        }

    }

    public void deleteAddress(int addressId) {
        try {
            Throwable var2 = null;
            Object var3 = null;

            try {
                Connection connection = DBConnection.getConnection();

                try {
                    PreparedStatement pstmt = connection.prepareStatement("DELETE FROM addresses WHERE address_id = ?");

                    try {
                        pstmt.setInt(1, addressId);
                        int rowsDeleted = pstmt.executeUpdate();
                        if (rowsDeleted > 0) {
                            System.out.println("✅ Address deleted successfully.");
                        }
                    } finally {
                        if (pstmt != null) {
                            pstmt.close();
                        }

                    }
                } catch (Throwable var20) {
                    if (var2 == null) {
                        var2 = var20;
                    } else if (var2 != var20) {
                        var2.addSuppressed(var20);
                    }

                    if (connection != null) {
                        connection.close();
                    }

                    throw var2;
                }

                if (connection != null) {
                    connection.close();
                }
            } catch (Throwable var21) {
                if (var2 == null) {
                    var2 = var21;
                } else if (var2 != var21) {
                    var2.addSuppressed(var21);
                }

                throw var2;
            }
        } catch (SQLException e) {
            System.err.println("❌ Error deleting address: " + e.getMessage());
            e.printStackTrace();
        }

    }

    private Address extractAddress(ResultSet rs) throws SQLException {
        Address address = new Address();
        address.setAddressId(rs.getInt("address_id"));
        address.setUserId(rs.getInt("user_id"));
        address.setStreet(rs.getString("street"));
        address.setCity(rs.getString("city"));
        address.setState(rs.getString("state"));
        address.setZip(rs.getString("zip"));
        address.setLandmark(rs.getString("landmark"));
        address.setCreatedAt(rs.getTimestamp("created_at"));
        return address;
    }
}
